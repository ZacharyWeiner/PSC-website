<template>
    <Menu />
        <div
        class="h-36 bg-contain bg-center md:h-64"
        style="
            background-image: url('https://slavettes-layers.s3.amazonaws.com/pewnicorns/pewnicorns+header.png');
        "
        ></div>
    <div class="flex">
        <div class="w-full"></div>
        <div class=""><button @click="lastPage" class="p-2 m-2 text-white text-xl bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl"> Back </button></div>
        <div class=""><button @click="nextPage" class="p-2 m-2 text-white text-xl bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl"> Next </button></div>
        <div class="w-full"></div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-4 ">
           <div v-for="(order, index) in orderedNFTs" :key="index" class="col-span-1 mb-4 mx-1 bg-gray-900 rounded">
               <img :src="getBerryUrl(order)" class="w-full" />
               <div class='grid grid-cols-4'  :class='rankClass(order)'>
                    <div class='w-full col-span-2'> <div class='mx-auto'> Edition {{order.props.no}}</div>  </div>
                    <div class='col-span-1'> <div class='mx-auto'> Rank # {{rankNFT(order)}}</div>  </div>
                    <div class='col-span-1'> <div class='mx-auto'> â‚¿ {{order.satoshis / 100000000}}</div>  </div>
                    
                </div>
                <div class="">
                         <div class='text-4xl pt-2' :class='rankTextClass(order)'>{{rankText(order)}} </div>
                    </div>
                <div class="m-4"> 
                     <div class="m-4"> 
                     <button class="bg-blue-500 rounded-xl text-white p-2 m-2" @click="buy(order)">{{buyButtonText(order)}}</button>
                    </div>
                </div>
           </div>
       </div>
       <div class="flex">
        <div class="w-full"></div>
        <div class=""><button @click="lastPage" class="p-2 m-2 text-white text-xl bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl"> Back </button></div>
        <div class=""><button @click="nextPage" class="p-2 m-2 text-white text-xl bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl"> Next </button></div>
        <div class="w-full"></div>
    </div>
</template>

<script>
import Menu from "./../../components/Menu.vue"
import { reactive, toRefs } from 'vue'
import axios from "axios";
let rank = [1353,1382,1523,604,1004,1531,234,1095,1177,547,2162,396,2150,174,1565,1798,353,2178,241,1646,1788,1685,933,1344,1769,1090,642,2047,2049,1777,1992,504,251,605,1012,445,1695,1927,952,1385,1908,2172,1557,600,818,1973,1449,1198,1898,653,1636,144,225,894,36,362,657,675,1566,108,843,1934,1888,920,718,2152,1409,2165,428,557,1794,679,1136,1469,1532,1909,554,1484,1145,1765,267,2111,1149,1502,529,1239,517,55,762,1538,253,538,450,1174,1790,76,1613,1256,919,64,198,528,2126,341,1083,1610,2098,897,555,1514,1879,2128,1608,27,706,1515,2009,432,249,53,131,5,1018,1743,444,86,1371,1693,674,2043,229,1212,1249,1485,1388,102,1682,1264,1529,1590,506,145,778,2182,2058,1810,1135,472,2037,2016,551,1890,1285,1372,479,1914,2123,1951,321,2205,87,2222,1,816,2057,2129,2066,558,1416,1650,1939,2070,678,1940,1219,1250,1200,1979,467,2206,311,356,1213,1452,320,1834,862,377,1840,1638,1260,367,917,1512,221,859,69,118,54,2174,1207,2092,937,1257,1163,1872,1581,94,948,1214,218,565,1349,1454,848,208,1099,2039,1633,892,465,1780,1555,707,1011,1006,2081,913,136,711,2203,461,1162,1745,992,764,1536,1692,296,1419,684,787,746,669,701,1852,1703,2017,1985,682,1943,546,373,2004,375,2156,101,597,1774,335,583,564,1641,1007,158,1455,75,1846,815,2091,2006,2122,2143,1152,247,480,953,1122,382,1205,2168,900,891,1355,1793,1326,1797,455,1066,2090,1074,548,1767,1981,2108,1989,747,1414,1277,1340,2001,261,1511,2163,1583,2078,2075,1573,1339,668,1119,209,640,1509,773,502,884,1052,1647,775,620,2218,72,1983,1223,563,429,275,1476,883,2042,1043,990,1442,28,1827,1077,430,742,212,1886,802,1741,649,2198,414,1811,419,798,729,1187,591,914,1441,849,1950,2171,293,61,855,509,78,1497,281,1443,2054,592,7,1560,1439,1830,380,1887,266,246,1980,1540,1319,1762,233,301,2086,754,1585,1282,1982,1061,1751,1244,62,424,1229,1911,1635,224,1505,436,1270,971,539,284,721,1784,710,222,1901,999,1276,536,1291,761,67,384,1015,202,1325,1580,1079,1971,107,1071,1525,1999,255,590,1771,2170,1057,755,2215,1559,1713,983,1702,1039,331,549,1783,2020,1778,1347,401,1831,1752,130,2040,599,391,1127,727,889,119,1861,1500,1204,161,2204,163,1303,1948,214,732,1460,962,124,864,1237,515,1286,103,1169,602,178,878,876,1740,527,2052,1867,458,1919,1855,2189,427,780,1710,525,836,1398,772,1352,523,2220,929,1265,743,392,1920,1803,635,423,730,1049,1552,774,673,1723,861,2136,984,1088,770,586,1138,1938,1918,1859,837,2044,863,1715,748,1750,2115,560,389,1584,1998,1110,705,931,1383,143,139,722,2144,1191,860,501,2063,1569,26,1945,2192,2060,768,580,1165,1556,171,167,337,788,520,1320,1424,1487,453,852,191,2021,2074,961,784,394,2056,588,1733,1058,909,1889,1070,33,435,474,488,1030,1281,1309,47,1102,1548,698,1732,829,1321,1489,1438,1193,1929,290,2195,217,80,1812,1227,425,1993,1824,844,573,1988,741,2166,907,236,300,533,1956,666,918,1678,1561,1668,996,1054,681,1857,1618,713,716,25,88,1786,1019,866,514,511,365,1528,808,157,1150,1014,1570,1302,1759,292,1995,575,1683,2010,1208,433,1847,431,899,902,607,1288,180,2214,1029,1081,1932,865,374,672,383,1062,1203,245,800,869,1739,752,810,276,1894,359,1113,2211,2197,621,1296,1974,744,1269,1091,508,2208,176,1949,8,1785,315,2038,881,1964,1882,814,6,220,2065,1899,792,2077,1615,2177,1492,1397,1085,494,1183,1611,1773,477,1606,1196,779,1327,1343,2080,1451,986,2176,1595,1065,1283,1630,890,626,648,351,1959,135,758,12,524,1230,134,1369,1651,1189,1141,459,491,2141,1711,839,172,1000,579,1148,1624,1958,1539,476,543,871,581,609,834,1941,1129,1301,471,790,1010,164,2045,608,1299,1808,1825,989,2036,627,1698,378,1782,74,125,692,702,1312,1112,1176,1659,258,1461,1821,1373,286,1851,959,2000,2068,277,162,24,1658,1336,1322,270,1916,309,454,1519,1422,2023,1211,596,1681,825,1900,947,1267,223,1701,1604,589,30,1853,2184,403,483,1837,111,912,585,1875,1013,1381,969,106,677,1960,369,1346,116,1459,77,326,552,1003,1891,299,1380,1968,2072,1963,2207,1533,1616,1103,966,312,1298,340,686,1201,1758,1235,1132,66,1287,1832,1946,740,1599,1185,1016,1972,1064,2061,31,1947,824,1100,797,1480,449,2213,970,402,1402,1324,1121,2076,1537,439,93,840,1329,1362,1833,2048,1097,1400,1222,2064,407,835,1735,1142,1696,1957,795,154,1254,1293,318,1924,757,412,1252,1516,122,1621,1060,2210,831,1192,1815,187,1164,192,81,1194,613,1571,1116,248,1146,325,1729,1836,1394,1155,1517,1053,1486,793,2007,148,1688,98,1318,1582,1413,2112,415,856,2117,1746,1139,1792,1835,857,1866,2137,643,1620,2024,1770,1937,2051,2201,1936,1236,2100,2025,295,2212,1375,661,185,1255,19,1657,719,183,1433,2183,1644,285,11,830,307,601,1114,159,2158,1068,847,146,1796,2135,190,751,484,204,1046,475,39,96,670,1440,1446,1434,149,911,1870,1335,1534,132,566,227,200,22,972,1553,1969,1931,1675,237,567,1040,73,1426,242,951,1108,1156,1577,1873,175,264,1024,1816,1926,63,14,789,1450,129,1234,1342,1456,1168,213,1002,2033,1172,197,841,260,2200,587,838,936,1401,1133,2082,903,181,556,1199,532,2154,2069,2167,1730,182,1910,503,867,123,845,1673,1996,2008,1507,1912,291,1134,1354,1648,243,1435,578,2087,274,1242,568,1417,963,1360,2113,638,704,404,1649,32,584,2190,305,400,2035,114,2050,1813,1399,1464,1431,1513,1026,95,1028,1038,1331,2138,1541,1428,2094,1930,652,1263,1594,2093,1549,1032,1405,1687,203,991,516,41,1217,2133,194,283,411,2041,537,1724,1804,97,733,1781,83,254,1475,110,1653,121,619,397,1059,1521,1655,1333,364,51,1315,2186,1037,421,726,916,2109,235,40,993,250,1494,1961,259,349,2096,612,1463,1987,1722,1363,207,147,1118,1966,1210,195,1865,561,1328,115,50,827,1666,1501,1748,1814,1843,2032,1171,1802,1082,1182,2124,179,2155,943,21,1535,1719,2002,15,1493,1130,409,811,1822,2011,946,1216,466,1423,1705,542,1093,2157,1518,1123,92,1048,939,799,1923,288,65,893,614,45,1384,1576,1598,201,1498,345,438,1161,1027,1357,240,569,2175,1306,298,332,2104,1736,2003,357,945,1143,1366,496,1488,184,1760,1332,1115,426,57,1178,974,1251,934,287,712,1120,2031,1607,1289,1181,1789,1967,1290,1253,1184,1667,949,448,1221,2173,23,2019,1243,196,507,1436,160,804,256,1175,603,1578,155,1001,2140,1292,1699,858,1975,1073,1392,1075,888,1828,1868,330,1490,1316,735,99,817,1991,226,1660,386,1849,452,323,1551,481,819,456,2147,1720,1935,629,582,1117,1829,1470,544,18,720,1180,1047,1697,137,667,1345,1087,1994,1761,1462,930,10,493,1495,1341,1041,169,4,694,408,138,239,697,1105,205,1370,387,1258,1404,1728,2067,1096,1904,333,440,935,1195,1564,1763,348,882,1970,2062,354,886,531,2142,1279,1684,756,1575,1094,228,535,1805,505,703,490,2059,1567,2130,188,1131,390,2099,572,1976,1232,2164,683,1764,2022,1188,1128,1020,1550,1418,785,1477,1952,1990,1942,2,1268,709,1444,1876,975,355,1351,1092,1757,1754,553,1554,663,928,651,1717,1670,1280,112,559,731,766,958,489,1153,1622,1170,1350,282,327,59,715,1017,1863,1997,469,1881,117,446,151,1403,1799,1572,759,2139,1471,1944,2161,358,853,901,1623,71,485,994,1295,463,2005,1348,2027,908,166,924,422,35,1005,2159,257,1671,690,457,399,1300,616,2146,530,393,1504,1893,219,820,140,1021,512,736,1674,1468,1818,478,1317,1522,2015,623,647,1078,1215,1140,1278,1589,1631,17,46,470,1395,16,1558,1137,510,1848,416,2053,2188,1374,1686,2029,1305,2125,749,1860,2134,1272,336,868,1676,443,806,1159,1387,1844,1884,58,1051,316,1629,2014,1076,595,1396,1801,1978,823,1596,1033,1391,985,964,2073,1036,2118,1609,1031,664,1266,2191,1526,360,1896,1044,1072,1619,1632,1838,656,662,1800,1669,842,1694,1483,56,381,634,1628,338,906,1421,1756,120,1869,1106,413,921,395,1965,1167,1458,2219,1637,750,1386,689,688,1626,2148,168,1393,1530,104,141,1663,1897,410,982,366,1562,232,173,850,923,2193,1209,1820,303,1427,767,1597,574,2103,1323,1714,1432,738,1593,2132,2187,1654,265,1067,1508,230,1238,980,199,765,1544,658,1310,941,1379,965,987,1677,676,313,437,791,1035,1791,133,1903,617,1587,1817,1307,854,370,826,1337,1499,699,1410,809,2145,1008,633,495,1612,1738,216,347,1731,352,2110,308,1928,1955,2149,109,981,442,944,1819,238,405,1524,1601,1591,434,622,1157,42,1690,342,1543,598,777,611,522,1634,2127,2018,905,1775,319,372,262,1716,441,724,570,1679,763,654,1842,2083,273,1063,464,2055,977,252,1338,519,973,297,1718,1862,1147,231,1874,38,20,170,215,1273,1642,671,2097,1744,1472,803,1605,1160,625,978,1602,998,1107,271,1173,1954,85,2121,922,1364,1467,268,1826,1885,1086,637,1933,1481,725,34,1080,2071,1389,1691,1055,1050,2196,957,1104,406,1603,2199,269,745,324,368,91,805,513,1617,2102,497,1248,877,870,1479,1144,628,1297,577,1542,571,812,48,898,2131,968,1240,2185,1640,1925,3,728,2221,1917,60,873,206,278,346,550,693,1807,2079,1124,807,1704,1089,954,1186,846,794,695,610,156,1779,1672,1795,334,2194,2046,1496,193,997,1478,49,499,1962,1725,376,691,460,696,1809,371,1376,1614,1823,2026,956,1111,279,645,2107,976,13,904,1314,1563,796,1627,1274,1643,650,940,100,771,418,1546,1420,2114,9,1850,1158,1892,2181,43,723,988,1233,1430,1665,2030,875,1084,2179,1406,1709,540,624,821,1022,2034,1023,1755,105,655,1356,2202,2119,343,680,1151,1378,1025,113,1045,1109,1545,576,1447,492,631,500,153,52,2180,659,79,1334,1588,1547,783,950,473,1034,1367,979,1727,2151,630,1218,128,1259,1902,734,388,833,896,1275,1390,1592,639,615,2088,700,1294,1768,832,1652,636,1721,632,1445,714,447,541,1009,68,1625,1228,1921,29,1747,769,955,2101,2216,420,2217,2095,717,874,851,152,885,486,1913,361,1231,1304,1365,1639,263,1586,302,534,594,641,932,1206,1700,518,1753,498,1241,1377,2209,1776,1839,1466,1415,1190,379,753,2028,363,828,2089,1712,739,1734,2085,1247,1482,1645,1662,1953,938,1226,1491,960,1871,1878,1895,822,1689,1742,737,1245,1457,801,813,1308,1656,310,562,1056,89,618,660,1098,895,1125,1330,879,1708,2013,211,1905,244,1984,1977,1313,1473,644,1527,1510,1600,687,2084,294,1922,127,322,776,1202,1880,462,1806,1856,1877,314,1361,1429,1864,927,880,1506,1986,82,306,329,1220,1766,1069,344,1520,1680,593,1858,2153,1772,1246,186,942,1311,1574,1179,70,1915,665,887,915,1154,685,339,398,2105,1568,1408,289,2106,1166,1412,44,1407,1706,1358,1737,1262,1845,1907,1503,2116,272,1474,280,1411,165,177,872,1883,2012,210,1101,1425,451,37,84,1197,468,521,1854,142,350,317,385,417,1448,782,926,1284,1437,1787,760,304,1664,1271,708,90,1841,925,1225,1359,1465,646,150,606,1261,1453,126,328,910,995,1707,545,1126,1661,1749,1368,1726,482,781,967,1224,1579,487,2160,2169,189,526,786,1042,1906,2120]
export default {
    components:{Menu},
    async setup () {
        let { data } = await axios.get("https://staging-backend.relayx.com/api/market/84fdb5121bcb556682e872c98f5bad0f7109807d9395b4c2b087ab401c63ee5d_o2/orders");
        let orders_raw  = data.data.orders
        let orders = orders_raw.filter((o) => rank.indexOf(o.props.no) < 1499)
        orders.sort((a, b) =>{ 
            let a1 =  parseInt(a.satoshis, 10)
            let b1 =  parseInt(b.satoshis, 10)
            return a1- b1
           });
        const state = reactive({
            count: 0,
            page: 0,
            selectedOrderTxid:"",
            error: ""
        })
    
        return {
            ...toRefs(state),
            orders,
        }
    },
    methods:{
        async buy(order){
            try{
            this.selectedOrderTxid = order.txid
             let response = await axios.post('https://staging-backend.relayx.com/api/dex/buy', {
                    address: this.$store.state.user_address,
                    location: "84fdb5121bcb556682e872c98f5bad0f7109807d9395b4c2b087ab401c63ee5d_o2",
                    txid: order.txid,
                })
                console.log(response)
                let sendResponse = await window.relayone.send(response.data.data.rawtx)
                console.log(sendResponse)
                this.buyText =  "BUY NOW"
                window.location.reload();
                }catch(err){
                    this.error = err;
                    alert(err);
                }
        },
         getBerryUrl(order){
            let suffix = order.berry.txid
            if(suffix){
                return 'https://berry.relayx.com/'+ suffix
            }
            return ''
            
        },
         rankNFT(nft){
             const i = parseInt(nft.props.no)
             let rankSpot = rank.indexOf(i) 
             return rankSpot + 1;
        },
        rankClass(nft){
             let currentRank = this.rankNFT(nft)
             if(currentRank <= 22) {return "bg-teal-200 text-teal-800"}
            if(currentRank <= 111) {return "bg-yellow-800 text-yellow-200"}
            if(currentRank <= 333) {return "bg-red-600 text-red-200"}
            if(currentRank <= 666) {return "bg-green-600 text-green-100"}
            if(currentRank <= 1111) {return "bg-blue-600 text-blue-200"}
            return "bg-gray-700 text-gray-100"
        },
        rankTextClass(nft){
             let currentRank = this.rankNFT(nft)
             if(currentRank <= 22) {return "font-extrabold bg-gradient-to-b from-teal-200 via-indigo-400 to-blue-700 bg-clip-text text-transparent"}
            if(currentRank <= 111) {return "font-extrabold bg-gradient-to-b from-yellow-200 via-yellow-400 to-yellow-700 bg-clip-text text-transparent"}
            if(currentRank <= 333) {return "font-extrabold bg-gradient-to-b from-red-200 via-red-400 to-red-700 bg-clip-text text-transparent"}
            if(currentRank <= 666) {return "font-extrabold bg-gradient-to-b from-green-200 via-green-400 to-green-700 bg-clip-text text-transparent"}
            if(currentRank <= 1111) {return "font-extrabold bg-gradient-to-b from-blue-200 via-blue-400 to-blue-700 bg-clip-text text-transparent"}
            return "font-extrabold bg-gradient-to-b from-gray-200 via-gray-400 to-gray-700 bg-clip-text text-transparent"
        },
        rankText(nft){
            
             let currentRank = this.rankNFT(nft)
             if(currentRank <= 22) {return "Exotic"}
            if(currentRank <= 111) {return "Legendary"}
            else if(currentRank <= 333) {return "Epic"}
            else if(currentRank <= 666) {return "Rare"}
            else if(currentRank <= 1111) {return "Uncommon"}
            return "Common"
        },
        resetPage(){
            this.page = 0
        },
        nextPage(){
            this.page = this.page + 1
            console.log(this.page)
        },
        lastPage(){
            if(this.page >= 2){this.page = this.page - 1}
        },
        buyButtonText(order){
            if(this.error !== ""){
                return this.error
            }
            if(order.txid  === this.selectedOrderTxid){
                return "Buying... "
            }
            return "BUY NOW"
        }
    },
    computed:{
        orderedNFTs(){
           let pageStart = 0;
           let pageEnd =20;
           if(this.page >= 1) {
               pageStart = (this.page * 20);
               pageEnd = pageStart + 20;
           }
           return this.orders.slice(pageStart, pageEnd)
        },
    }
}
</script>

<style lang="scss" scoped>

</style>