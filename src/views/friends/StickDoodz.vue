<template>
   <Menu />
        <div
        class="h-36 bg-contain bg-center md:h-64"
        style="
            background-image: url('https://slavettes-layers.s3.amazonaws.com/pewnicorns/pewnicorns+header.png');
        "
        ></div>
    <div class="flex">
        <div class="w-full"></div>
        <div class=""><button @click="lastPage" class="p-2 m-2 text-white text-xl bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl"> Back </button></div>
        <div class=""><button @click="nextPage" class="p-2 m-2 text-white text-xl bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl"> Next </button></div>
        <div class="w-full"></div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-4 ">
           <div v-for="(order, index) in orderedNFTs" :key="index" class="col-span-1 mb-4 mx-1 bg-gray-900 rounded">
               <img :src="getBerryUrl(order)" class="w-full" />
               <div class='grid grid-cols-4'  :class='rankClass(order)'>
                    <div class='w-full col-span-2'> <div class='mx-auto'> Edition {{order.props.no}}</div>  </div>
                    <div class='col-span-1'> <div class='mx-auto'> Rank # {{rankNFT(order)}}</div>  </div>
                    <div class='col-span-1'> <div class='mx-auto'> â‚¿ {{order.satoshis / 100000000}}</div>  </div>
                    
                </div>
                <div class="">
                         <div class='text-4xl pt-2' :class='rankTextClass(order)'>{{rankText(order)}} </div>
                    </div>
                <div class="m-4"> 
                     <div v-if="order.satoshis < 10000000">
                        <button class="bg-blue-500 rounded-xl text-white p-2 m-2" @click="buy(order)">{{buyText}}</button>
                    </div> 
                    <div v-else> 
                    <a noopener norel target="_blank" class="bg-blue-500 rounded-xl text-white p-2 m-2" :href="`https://www.relayx.com/market/f181e9e9883bc2dfb233b10e75a378f06715e25da5163d423d8f6d07a843bcdd_o2/${order.location}`"> BUY ON RELAY </a>
                    </div>
                </div>
           </div>
       </div>
       <div class="flex">
        <div class="w-full"></div>
        <div class=""><button @click="lastPage" class="p-2 m-2 text-white text-xl bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl"> Back </button></div>
        <div class=""><button @click="nextPage" class="p-2 m-2 text-white text-xl bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl"> Next </button></div>
        <div class="w-full"></div>
    </div>
</template>

<script>
import { reactive, toRefs } from 'vue'
import  axios from "axios";
import Menu from "./../../components/Menu.vue";
let rank = [711,856,1454,1508,513,1025,1865,487,688,612,363,1730,455,1868,1323,1714,381,875,2,227,1801,1638,377,1158,1099,840,26,439,1554,1686,1032,1028,1862,1040,386,199,1306,903,390,249,331,1413,816,520,1802,405,323,1283,317,1310,1081,723,670,1741,1428,50,540,1763,77,717,1834,627,681,143,13,434,225,100,532,677,631,1433,498,1007,1379,1217,328,215,591,989,443,1146,1761,1894,868,197,793,924,1534,5,1675,702,1551,750,923,1964,738,1481,1653,803,309,512,457,1877,1967,1123,1018,891,168,905,71,1259,1281,172,80,635,133,167,1532,1017,519,1203,887,1031,741,770,1867,1255,1240,943,1625,1019,801,845,284,926,579,812,31,1922,1824,333,1093,1342,860,1715,786,240,412,938,424,1777,1320,84,998,316,1464,1096,787,1822,1743,373,488,89,430,1717,895,1435,1351,722,1358,582,1503,185,1319,302,1584,1734,1810,1278,1271,1597,1591,577,1411,292,1213,1172,1114,1293,962,1783,44,1621,1036,728,1133,1473,1853,922,63,145,270,766,1726,490,824,1608,1087,916,1633,1593,806,1436,823,1692,43,690,1523,129,1029,914,811,1771,1949,212,852,593,261,312,345,1366,564,731,1326,86,1851,1088,141,906,352,1780,1011,83,963,1135,155,959,705,21,1768,1996,1056,388,988,1021,1846,1933,1185,1965,533,1312,1381,1999,96,617,558,1907,296,846,441,216,12,1198,1012,1538,1486,810,798,293,947,548,1483,269,1339,33,282,1747,1090,657,409,976,986,1279,1772,1620,1082,921,1700,1611,120,915,506,720,1383,245,1972,640,1180,204,1159,470,1333,1830,683,568,445,1371,758,867,865,580,599,42,633,1347,517,162,1243,69,1986,263,628,1604,1875,993,209,1934,1487,1636,1152,418,1324,1719,1541,1909,710,799,1335,1577,15,1490,1340,544,1078,180,341,1357,58,1976,1548,1035,1568,486,857,1937,1698,691,1202,1547,426,330,294,154,1440,1963,399,1263,602,727,1685,1897,55,788,1562,136,890,41,1343,796,238,1384,603,671,1902,1377,1125,1936,983,1301,1634,818,648,494,182,749,19,237,1421,1739,1881,164,615,1228,1498,1274,1678,777,830,410,60,1094,85,1496,1089,1722,1267,1472,547,480,29,104,885,40,1623,1539,1403,1414,536,514,1460,511,997,538,87,1746,1330,553,838,1142,1244,1477,461,904,1521,1192,265,105,990,379,251,147,394,1449,1230,1334,820,555,1662,1572,697,1210,1958,1047,1066,1432,1624,325,1814,1514,221,1989,752,1535,1581,232,1204,474,1563,1003,1045,449,715,675,930,359,1005,123,1684,666,847,351,452,400,223,892,1249,1948,1257,192,174,619,854,1233,1250,1901,737,1854,1236,739,1632,198,1058,1755,785,1057,1586,940,853,1071,1871,1238,1670,695,1466,170,525,1074,1207,149,1173,1091,34,125,546,1969,951,1216,1218,1407,1696,1921,861,1010,1390,1513,893,193,596,968,1585,701,743,1952,1124,1105,1973,642,1459,1450,1039,1138,165,1786,901,795,1982,387,1130,211,1887,233,706,1727,1292,1841,1831,1580,1720,1051,1516,1416,68,108,66,1879,808,634,1840,207,735,188,909,653,231,75,1615,266,1610,1485,419,1788,306,1050,578,73,1556,971,1341,1811,1531,122,1063,1226,1118,832,1348,1504,897,900,186,1355,504,537,372,1872,1305,208,1655,70,1836,1209,1410,281,1402,1065,1886,177,1978,1552,423,1980,784,1762,1957,1932,907,1764,570,636,834,1295,1882,471,1126,1529,1660,876,1314,1163,148,1765,733,1658,687,776,1596,873,572,1769,1211,1609,1345,714,81,191,1689,1590,1711,1232,632,908,1223,1852,1873,542,663,79,1953,652,336,495,1525,132,1583,764,985,972,1016,1299,1370,1289,667,1816,589,258,1121,1303,1827,1674,1465,277,1537,1838,1009,592,679,1629,248,814,1451,114,10,1925,1170,552,1839,1776,1055,451,1787,1001,1397,1927,1784,1680,1149,1176,321,420,156,425,355,1708,1566,1646,1808,754,1139,742,638,1905,179,1688,176,1417,106,1842,52,1189,1835,647,1455,604,1111,329,446,1794,391,1418,1426,621,1458,1356,468,878,1467,694,272,1269,1059,1415,1890,305,661,462,1325,1505,574,1367,286,967,1102,1889,1544,1960,206,1635,1453,1499,1196,364,1917,1109,1284,14,427,620,1849,566,1819,692,1296,169,131,1100,1115,11,1970,1567,274,748,712,866,1188,93,1790,228,528,1491,567,1462,1363,1054,1622,1679,1598,1896,1770,239,805,1234,1097,1354,858,1571,1150,1956,1517,255,339,755,1589,1792,1981,324,190,1095,236,1666,1127,300,189,1430,516,912,1511,662,1804,956,48,150,1697,415,703,159,366,1258,987,1220,1175,1988,744,1401,102,1046,774,1235,1144,1219,475,1190,605,1298,879,1939,935,1154,1729,1627,707,575,1376,804,1966,173,1706,24,958,184,1086,598,1930,775,124,1080,685,1225,1565,1375,1408,297,1382,1900,1759,1062,899,975,829,95,1506,827,1445,1587,1673,1336,936,1282,1042,929,111,1832,496,802,431,1256,1079,127,1294,565,585,1214,59,229,562,1077,1053,1701,527,1184,1641,1913,285,969,61,1075,1479,1557,813,1197,571,790,1693,1136,1174,1942,1644,222,1946,1694,1941,573,1974,1131,721,1104,1171,264,25,937,1156,1322,1883,1809,1725,747,586,243,3,1724,1222,1441,771,1578,1140,65,362,1412,308,290,1027,1594,454,1501,472,1817,762,403,1495,382,107,307,1602,1795,1773,1165,1667,1985,1380,98,815,278,1148,783,1699,1558,1885,991,1157,583,698,1549,279,1251,160,187,1929,1424,1020,2000,982,1098,1618,780,1880,1420,1061,39,898,1338,64,37,682,896,1607,1723,1861,1707,1275,1515,794,153,1843,1923,275,1327,429,1129,181,1860,1030,1732,1898,1273,1617,729,674,1160,161,1227,416,1866,1200,1106,1252,534,518,614,1155,262,1502,1642,257,760,1229,1690,941,370,414,393,1661,1789,1559,117,1014,254,894,825,1265,713,1137,144,1910,8,611,1575,1004,466,99,773,1990,493,1758,335,437,314,1147,955,992,401,523,499,535,32,1731,1756,1178,1108,1924,1553,740,287,716,944,778,241,1161,67,746,271,1631,1695,397,28,1476,1153,1716,276,1362,1253,1470,1134,1151,1482,826,641,1291,862,134,1855,138,318,933,584,883,337,871,659,196,224,1110,629,1874,1914,202,839,1938,1247,1533,995,1469,932,639,501,16,1270,1903,917,1350,1391,53,1906,360,848,6,1951,1287,1285,606,1364,1962,1524,1798,477,1665,1668,303,1052,1043,158,1754,1002,918,1272,1977,301,1023,459,1891,1536,442,291,996,543,432,1422,931,1744,195,595,1205,1945,886,590,1991,1492,549,1979,1280,1072,809,1712,1201,36,1076,45,902,259,178,1752,1796,686,849,981,78,1068,367,1847,1177,1649,507,1493,1856,1262,1703,483,1601,22,234,939,1920,1489,977,864,422,1015,392,556,1452,505,1793,365,1738,1619,736,1753,1,1199,311,1540,1431,1457,828,734,1365,725,402,469,183,1778,745,47,925,1959,1961,539,1785,569,421,1892,1006,1484,1070,163,954,1119,600,769,1329,1628,54,1073,326,850,347,1437,1195,759,74,700,1683,30,1640,1829,1193,101,1663,356,1639,1346,767,855,361,1393,1276,1751,369,1818,1439,213,338,1132,456,1388,1313,676,874,791,1800,51,1760,244,310,1895,693,960,1304,673,1266,837,368,1677,843,515,219,1713,1595,772,841,157,1691,1434,1392,718,1297,1614,1863,1328,655,1386,1605,1447,139,626,214,1311,353,1368,668,503,126,1918,1681,1626,1182,1224,203,1208,1806,1573,623,1049,1206,343,1168,872,481,1664,137,1742,934,374,1423,756,413,1876,411,304,1782,1823,1212,1215,1710,428,1191,479,1606,1237,1167,1302,643,561,1446,1908,357,613,821,1166,320,1317,1013,1943,1181,1858,1425,1463,46,836,491,877,610,1344,295,1954,358,1791,1654,1369,624,1286,1659,665,946,1474,649,1721,1239,1926,1848,250,637,1987,870,1828,1994,1404,732,1955,763,966,646,407,1757,928,1406,408,242,651,696,334,56,92,919,166,1748,1478,1745,1442,1820,1361,609,550,1899,1475,622,952,654,545,1869,256,1117,557,559,942,560,23,1444,384,1268,378,608,463,1709,526,1260,1612,684,1975,260,1241,1749,999,1507,660,1555,844,1561,831,1931,1359,851,1893,1702,1579,1092,313,1546,680,1570,1349,1527,458,1037,1968,1024,1085,1246,1103,246,1912,551,57,319,1112,965,484,1048,1033,1528,819,404,1044,779,521,1083,1309,1645,1337,1833,984,94,1935,530,630,1394,253,524,1179,1471,1360,730,1803,217,757,554,672,1261,961,140,1766,1588,1353,1429,888,450,7,49,1821,205,1116,1616,1321,130,1300,881,1797,1919,1750,1704,340,1169,625,247,1669,346,1543,1947,354,1845,508,1288,1034,17,1315,396,980,1837,597,322,115,230,1512,1519,1316,927,1603,118,18,726,1510,226,1041,1500,1026,708,112,1352,910,152,448,389,563,0,497,1560,1409,151,835,20,1084,1427,288,1807,460,1870,342,1331,201,781,453,950,1277,1733,1509,1735,27,1405,1650,1630,464,1164,1385,587,1290,719,1940,344,724,1950,1911,1318,4,822,1740,1067,1242,1651,1264,267,146,1254,1671,650,1542,792,1448,72,1522,765,1582,435,1915,383,699,283,1812,1928,529,268,1069,1884,797,817,109,1468,1113,1705,1194,880,116,113,1332,973,332,91,1944,1494,1389,299,594,1145,1443,964,1775,128,1107,1307,1826,252,1995,1850,121,1187,948,656,88,38,1672,1718,1637,1779,235,1737,833,1398,863,473,500,1488,1060,103,417,1143,1613,789,210,476,751,1395,1767,1569,465,1387,1599,1736,200,315,704,1400,175,522,35,1120,541,709,1374,1600,978,2001,298,1396,644,489,1245,119,280,1682,273,1186,882,327,194,97,1774,1248,1815,1825,1805,607,1545,913,1008,1781,478,509,1231,1419,761,1888,1574,1550,510,1997,467,438,953,645,859,669,380,502,1520,678,482,1647,171,1480,957,1916,1530,349,376,1799,768,1643,1592,1141,1372,576,1657,1162,911,1064,753,1857,1000,1656,142,1128,974,1971,1993,492,1456,1904,350,398,979,970,440,1844,1378,588,782,1497,1373,1221,62,1399,531,371,1576,135,348,9,1998,1183,842,800,1687,1813,618,218,1652,949,1038,994,1101,869,220,945,601,406,664,1728,920,658,1438,110,395,444,436,1992,1518,689,884,1526,1308,433,616,1461,1022,807,76,1564,447,1648,82,1859,289,1878,485,1676,90,581,1864,375,889,1122,385]
export default {
    components: {Menu},
    async setup () {
        let { data } = await axios.get("https://staging-backend.relayx.com/api/market/f181e9e9883bc2dfb233b10e75a378f06715e25da5163d423d8f6d07a843bcdd_o2/orders");
        let orders_raw  = data.data.orders
        let orders = orders_raw.filter((o) => rank.indexOf(o.props.no) < 1499)
        orders.sort((a, b) =>{ 
            let a1 =  parseInt(a.satoshis, 10)
            let b1 =  parseInt(b.satoshis, 10)
            return a1- b1
           });
        const state = reactive({
            count: 0,
            page: 0,
            buyText: "BUY NOW"
        })
    
        return {
            ...toRefs(state),
            orders,
        }
    },
    methods:{
        async buy(order){
            try{
            this.buyText= "Buying ..."
             let response = await axios.post('https://staging-backend.relayx.com/api/dex/buy', {
                    address: this.$store.state.user_address,
                    location: "f181e9e9883bc2dfb233b10e75a378f06715e25da5163d423d8f6d07a843bcdd_o2",
                    txid: order.txid,
                })
                console.log(response)
                let sendResponse = await window.relayone.send(response.data.data.rawtx)
                console.log(sendResponse)
                this.buyText =  "BUY NOW"
                window.location.reload();
                }catch(err){
                    this.buyText = "Error";
                    alert(err);
                }
        },
         getBerryUrl(order){
            let suffix = order.berry.txid
            if(suffix){
                return 'https://berry.relayx.com/'+ suffix
            }
            return ''
            
        },
         rankNFT(nft){
             const i = parseInt(nft.props.no)
             let rankSpot = rank.indexOf(i) 
             return rankSpot + 1;
        },
        rankClass(nft){
             let currentRank = this.rankNFT(nft)
             if(currentRank <= 20) {return "bg-teal-200 text-teal-800"}
            if(currentRank <= 100) {return "bg-yellow-800 text-yellow-200"}
            if(currentRank <= 300) {return "bg-red-600 text-red-200"}
            if(currentRank <= 600) {return "bg-green-600 text-green-100"}
            if(currentRank <= 1000) {return "bg-blue-600 text-blue-200"}
            return "bg-gray-700 text-gray-100"
        },
        rankTextClass(nft){
             let currentRank = this.rankNFT(nft)
             if(currentRank <= 20) {return "font-extrabold bg-gradient-to-b from-teal-200 via-indigo-400 to-blue-700 bg-clip-text text-transparent"}
            if(currentRank <= 100) {return "font-extrabold bg-gradient-to-b from-yellow-200 via-yellow-400 to-yellow-700 bg-clip-text text-transparent"}
            if(currentRank <= 300) {return "font-extrabold bg-gradient-to-b from-red-200 via-red-400 to-red-700 bg-clip-text text-transparent"}
            if(currentRank <= 600) {return "font-extrabold bg-gradient-to-b from-green-200 via-green-400 to-green-700 bg-clip-text text-transparent"}
            if(currentRank <= 1000) {return "font-extrabold bg-gradient-to-b from-blue-200 via-blue-400 to-blue-700 bg-clip-text text-transparent"}
            return "font-extrabold bg-gradient-to-b from-gray-200 via-gray-400 to-gray-700 bg-clip-text text-transparent"
        },
        rankText(nft){
            
             let currentRank = this.rankNFT(nft)
             if(currentRank <= 20) {return "Exotic"}
            if(currentRank <= 100) {return "Legendary"}
            else if(currentRank <= 300) {return "Epic"}
            else if(currentRank <= 600) {return "Rare"}
            else if(currentRank <= 1000) {return "Uncommon"}
            return "Common"
        },
        resetPage(){
            this.page = 0
        },
        nextPage(){
            this.page = this.page + 1
            console.log(this.page)
        },
        lastPage(){
            if(this.page >= 2){this.page = this.page - 1}
        },
    },
    computed:{
        orderedNFTs(){
           let pageStart = 0;
           let pageEnd =20;
           if(this.page >= 1) {
               pageStart = (this.page * 20);
               pageEnd = pageStart + 20;
           }
           return this.orders.slice(pageStart, pageEnd)
        },
    }
}
</script>

<style lang="scss" scoped>

</style>